<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" />
  <title>–ú–æ—ë –†–∞–¥–∏–æ</title>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body{
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      display:flex; justify-content:center; align-items:center;
      min-height:100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding:16px;
    }

    .player{
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(10px);
      padding: 32px 24px;
      border-radius: 32px;
      box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
      width:100%;
      max-width:400px;
    }

    .station-info{ text-align:center; margin-bottom:24px; }
    .station-name{ font-size:24px; font-weight:700; color:#1a1a1a; margin-bottom:8px; }
    .song-title{ font-size:18px; color:#4a5568; font-weight:500; margin-bottom:4px; word-break:break-word; }
    .dj-name{ font-size:14px; color:#718096; display:flex; align-items:center; justify-content:center; gap:8px; }

    .play-button-container{ display:flex; justify-content:center; margin: 32px 0; }

    .play-button{
      width:96px; height:96px; border-radius:50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border:none; color:#fff; font-size:48px;
      cursor:pointer; display:flex; align-items:center; justify-content:center;
      box-shadow: 0 20px 30px -10px rgba(102,126,234,0.5);
      transition: transform .2s, box-shadow .2s, opacity .2s;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
    }
    .play-button:active{ transform: scale(0.95); }
    .play-button.playing{
      background: linear-gradient(135deg, #f56565 0%, #c53030 100%);
      box-shadow: 0 20px 30px -10px rgba(245,101,101,0.5);
    }

    .volume-section{
      background:#f7fafc;
      border-radius:24px;
      padding:20px;
      margin:24px 0;
    }
    .volume-header{
      display:flex; justify-content:space-between; align-items:center;
      margin-bottom:12px; color:#2d3748; font-weight:600;
    }

    .volume-slider{
      width:100%;
      height:8px;
      border-radius:4px;
      background:#e2e8f0;
      outline:none;
      -webkit-appearance:none;
      appearance:none;
      touch-action: pan-x;
      position: relative;
      z-index: 5;
      cursor: pointer;
    }
    .volume-slider::-webkit-slider-thumb{
      -webkit-appearance:none;
      width:24px; height:24px;
      border-radius:50%;
      background:#667eea;
      box-shadow: 0 2px 6px rgba(102,126,234,0.4);
      border:2px solid #fff;
      cursor: pointer;
    }
    .volume-slider::-moz-range-thumb{
      width:24px; height:24px;
      border-radius:50%;
      background:#667eea;
      box-shadow: 0 2px 6px rgba(102,126,234,0.4);
      border:2px solid #fff;
      cursor: pointer;
    }

    .stats-grid{ display:flex; gap:12px; margin:20px 0; }
    .stat-item{ flex:1; background:#f7fafc; border-radius:16px; padding:12px; text-align:center; }
    .stat-label{ font-size:12px; color:#718096; margin-bottom:4px; }
    .stat-value{ font-size:18px; font-weight:700; color:#2d3748; }

    .history-section{ background:#f7fafc; border-radius:16px; padding:16px; margin-top:20px; }
    .history-title{ font-weight:600; color:#2d3748; margin-bottom:12px; font-size:16px; }
    .history-list{ max-height:160px; overflow-y:auto; border-radius:12px; }
    .history-item{ padding:10px; border-bottom:1px solid #e2e8f0; font-size:13px; color:#4a5568; display:flex; gap:8px; }
    .history-item:last-child{ border-bottom:none; }
    .history-time{ color:#667eea; font-weight:600; white-space:nowrap; }

    .status-badge{
      display:inline-block;
      padding:6px 12px;
      border-radius:20px;
      font-size:12px;
      font-weight:600;
      margin-top:12px;
      user-select:none;
    }
    .status-badge.playing{ background:#c6f6d5; color:#22543d; }
    .status-badge.paused{ background:#fed7d7; color:#742a2a; }
    .status-badge.loading{ background:#feebc8; color:#7b341e; }

    .loading{ opacity: 0.7; pointer-events: none; }

    @media (max-width: 480px){
      .player{ padding:24px 16px; }
      .play-button{ width:80px; height:80px; font-size:40px; }
    }
  </style>
</head>

<body>
  <div class="player" id="player">
    <div class="station-info">
      <div class="station-name" id="stationName">–ú–æ—ë –†–∞–¥–∏–æ</div>
      <div class="song-title" id="currentSong">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      <div class="dj-name">
        <span>üéß</span>
        <span id="djName">DJ</span>
        <span>‚Ä¢</span>
        <span id="bitrate">128 kbps</span>
      </div>
    </div>

    <div class="play-button-container">
      <button class="play-button" id="playBtn" aria-label="Play/Pause">‚ñ∂</button>
    </div>

    <div class="volume-section">
      <div class="volume-header">
        <span>üîä –ì—Ä–æ–º–∫–æ—Å—Ç—å</span>
        <span id="volumePercent">75%</span>
      </div>
      <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" step="1" value="75">
    </div>

    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-label">–°–ª—É—à–∞—Ç–µ–ª–∏</div>
        <div class="stat-value" id="listenersCount">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">–ü–∏–∫</div>
        <div class="stat-value" id="peakListeners">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ</div>
        <div class="stat-value" id="quality">128</div>
      </div>
    </div>

    <div class="history-section">
      <div class="history-title">üéµ –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–µ–∫–∏</div>
      <div class="history-list" id="historyList">
        <div class="history-item">–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏...</div>
      </div>
    </div>

    <div id="statusBadge" class="status-badge paused">‚è∏ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</div>
  </div>

  <script>
    (() => {
      "use strict";

      // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
      const CONFIG = {
        streamUrl: "https://myradio24.org/98353",
        apiUrl: "https://myradio24.com/users/98353/status.json",
        stationName: "–ú–æ—ë –†–∞–¥–∏–æ",
        updateInterval: 10000,
        reconnectTimeout: 3000,
        storageKey: "radioVolume"
      };

      class RadioPlayer {
        constructor() {
          // –°–æ–∑–¥–∞–µ–º –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è iOS
          this.audio = new Audio();
          this.audio.preload = "none";
          this.audio.volume = 0.75; // –ù–∞—á–∞–ª—å–Ω–∞—è –≥—Ä–æ–º–∫–æ—Å—Ç—å 75%
          
          // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è iOS
          this.audio.playsInline = true;
          this.audio.setAttribute("playsinline", "");
          this.audio.setAttribute("webkit-playsinline", "");
          
          // –û—Ç–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∞–∫—Ç–∏–≤–∞—Ü–∏—é AirPlay
          this.audio.setAttribute("x-webkit-airplay", "allow");
          
          // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–ª–µ–µ—Ä–∞
          this.isPlaying = false;
          this.isLoading = false;
          this.reconnectTimer = null;
          this.updateTimer = null;
          
          // –¢–µ–∫—É—â–∞—è –≥—Ä–æ–º–∫–æ—Å—Ç—å (0-100)
          this.currentVolume = 75;
          
          // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
          this.el = {
            player: document.getElementById("player"),
            playBtn: document.getElementById("playBtn"),
            volumeSlider: document.getElementById("volumeSlider"),
            volumePercent: document.getElementById("volumePercent"),
            currentSong: document.getElementById("currentSong"),
            djName: document.getElementById("djName"),
            listenersCount: document.getElementById("listenersCount"),
            peakListeners: document.getElementById("peakListeners"),
            quality: document.getElementById("quality"),
            historyList: document.getElementById("historyList"),
            statusBadge: document.getElementById("statusBadge"),
            stationName: document.getElementById("stationName"),
            bitrate: document.getElementById("bitrate")
          };

          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏–∏
          this.el.stationName.textContent = CONFIG.stationName;

          // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
          this.loadSettings();
          
          // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
          this.setupEventListeners();
          
          // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç–∞–Ω—Ü–∏–∏
          this.fetchStationInfo();
          
          // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
          this.startInfoUpdates();
        }

        // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        normalizeVolume(v) {
          const n = Number(v);
          if (!Number.isFinite(n)) return 0;
          return Math.min(100, Math.max(0, Math.round(n)));
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        renderVolumeUI(v) {
          this.el.volumePercent.textContent = v + "%";
          
          // –ì—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è –ø–æ–ª–∑—É–Ω–∫–∞
          this.el.volumeSlider.style.background = 
            `linear-gradient(to right, #667eea 0%, #667eea ${v}%, #e2e8f0 ${v}%, #e2e8f0 100%)`;
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ (–æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥)
        setVolume(v) {
          const vol = this.normalizeVolume(v);
          this.currentVolume = vol;
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–∑—É–Ω–æ–∫
          this.el.volumeSlider.value = String(vol);
          
          // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç
          this.renderVolumeUI(vol);
          
          // –ü—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ –¥–ª—è iOS
          this.audio.volume = vol / 100;
          
          // –£–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∏–≥–ª—É—à–µ–Ω–∏–µ–º –∑–≤—É–∫–∞
          this.audio.muted = (vol === 0);
          
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
          localStorage.setItem(CONFIG.storageKey, String(vol));
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
        loadSettings() {
          const saved = localStorage.getItem(CONFIG.storageKey);
          const v = saved !== null ? this.normalizeVolume(saved) : 75;
          this.setVolume(v);
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        setupEventListeners() {
          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
          this.el.playBtn.addEventListener("click", () => this.togglePlay());
          
          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–ª–∑—É–Ω–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
          this.el.volumeSlider.addEventListener("input", (e) => {
            this.setVolume(e.target.value);
          });

          // –°–æ–±—ã—Ç–∏—è –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç–∞
          this.audio.addEventListener("play", () => {
            this.isPlaying = true;
            this.isLoading = false;
            this.updateUI();
          });

          this.audio.addEventListener("pause", () => {
            this.isPlaying = false;
            this.isLoading = false;
            this.updateUI();
          });

          this.audio.addEventListener("waiting", () => {
            this.isLoading = true;
            this.updateUI();
          });

          this.audio.addEventListener("canplay", () => {
            this.isLoading = false;
            this.updateUI();
          });

          this.audio.addEventListener("stalled", () => {
            if (this.isPlaying) {
              this.scheduleReconnect();
            }
          });

          this.audio.addEventListener("error", (e) => {
            console.error("Audio error:", e);
            if (this.isPlaying) {
              this.scheduleReconnect();
            } else {
              this.isPlaying = false;
              this.isLoading = false;
              this.updateUI();
            }
          });

          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ç–µ—Ä–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
          this.audio.addEventListener("ended", () => {
            if (this.isPlaying) {
              this.scheduleReconnect();
            }
          });

          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –æ—Ç Siri/—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–∞ iOS
          document.addEventListener("visibilitychange", () => {
            if (document.hidden && this.isPlaying) {
              // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–≥—Ä–∞—Ç—å –≤ —Ñ–æ–Ω–µ –Ω–∞ iOS
              console.log("App in background, audio continues");
            }
          });
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
        async togglePlay() {
          if (this.isLoading) return;
          
          if (this.isPlaying) {
            this.pause();
          } else {
            await this.play();
          }
        }

        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
        async play() {
          this.isLoading = true;
          this.updateUI();

          // –î–æ–±–∞–≤–ª—è–µ–º timestamp –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
          const streamUrl = CONFIG.streamUrl + 
            (CONFIG.streamUrl.includes("?") ? "&" : "?") + 
            "_t=" + Date.now();
          
          this.audio.src = streamUrl;
          this.audio.load();

          try {
            // –ü—ã—Ç–∞–µ–º—Å—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏
            await this.audio.play();
            
            // –£—Å–ø–µ—à–Ω–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è
            this.isLoading = false;
            this.isPlaying = true;
            this.updateUI();
          } catch (err) {
            console.error("Playback failed:", err);
            
            // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è iOS
            if (err.name === "NotAllowedError") {
              alert("–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –µ—â–µ —Ä–∞–∑ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è");
            }
            
            this.isLoading = false;
            this.isPlaying = false;
            this.updateUI();
          }
        }

        // –ü–∞—É–∑–∞
        pause() {
          // –û—á–∏—â–∞–µ–º —Ç–∞–π–º–µ—Ä –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
          if (this.reconnectTimer) {
            clearTimeout(this.reconnectTimer);
            this.reconnectTimer = null;
          }

          // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
          try {
            this.audio.pause();
          } catch (_) {}
          
          // –û—á–∏—â–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
          this.audio.src = "";
          this.audio.load();

          this.isPlaying = false;
          this.isLoading = false;
          this.updateUI();
        }

        // –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        scheduleReconnect() {
          if (this.reconnectTimer) return;

          this.reconnectTimer = setTimeout(async () => {
            this.reconnectTimer = null;
            
            if (!this.isPlaying) return;

            // –ü—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
            try {
              this.isLoading = true;
              this.updateUI();

              const streamUrl = CONFIG.streamUrl + 
                (CONFIG.streamUrl.includes("?") ? "&" : "?") + 
                "_r=" + Date.now();
              
              this.audio.src = streamUrl;
              this.audio.load();
              
              await this.audio.play();
              
              this.isLoading = false;
              this.updateUI();
            } catch (_) {
              this.isLoading = false;
              this.updateUI();
              
              // –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, –ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞ –ø–æ–∑–∂–µ
              if (this.isPlaying) {
                this.scheduleReconnect();
              }
            }
          }, CONFIG.reconnectTimeout);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        updateUI() {
          // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
          if (this.isPlaying) {
            this.el.playBtn.innerHTML = "‚è∏";
            this.el.playBtn.classList.add("playing");
          } else {
            this.el.playBtn.innerHTML = "‚ñ∂";
            this.el.playBtn.classList.remove("playing");
          }

          // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏
          if (this.isLoading) {
            this.el.playBtn.style.opacity = "0.7";
            this.el.statusBadge.textContent = "‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...";
            this.el.statusBadge.className = "status-badge loading";
            this.el.player.classList.add("loading");
          } else {
            this.el.playBtn.style.opacity = "1";
            this.el.player.classList.remove("loading");

            if (this.isPlaying) {
              this.el.statusBadge.textContent = "üîä –í —ç—Ñ–∏—Ä–µ";
              this.el.statusBadge.className = "status-badge playing";
            } else {
              this.el.statusBadge.textContent = "‚è∏ –ü–∞—É–∑–∞";
              this.el.statusBadge.className = "status-badge paused";
            }
          }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Ç–∞–Ω—Ü–∏–∏
        async fetchStationInfo() {
          try {
            const res = await fetch(CONFIG.apiUrl, { 
              method: "GET", 
              mode: "cors", 
              cache: "no-cache",
              headers: {
                "Cache-Control": "no-cache"
              }
            });
            
            if (!res.ok) throw new Error("Network error: " + res.status);
            
            const data = await res.json();

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º —Ç—Ä–µ–∫–µ
            if (data.song) {
              this.el.currentSong.textContent = data.song;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –¥–∏–¥–∂–µ—è
            if (data.djname) {
              this.el.djName.textContent = data.djname;
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–ª—É—à–∞—Ç–µ–ª–µ–π
            if (data.listeners !== undefined) {
              this.el.listenersCount.textContent = String(data.listeners);
            }
            
            if (data.plisteners !== undefined) {
              this.el.peakListeners.textContent = String(data.plisteners);
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–∏—Ç—Ä–µ–π—Ç–µ
            if (data.kbps !== undefined) {
              this.el.quality.textContent = String(data.kbps);
              this.el.bitrate.textContent = String(data.kbps) + " kbps";
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–µ–∫–æ–≤
            if (data.songs && Array.isArray(data.songs)) {
              this.updateHistory(data.songs);
            }
          } catch (e) {
            console.error("Failed to fetch station info:", e);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–µ
            this.el.currentSong.textContent = "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞";
          }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–µ–∫–æ–≤
        updateHistory(songs) {
          if (!songs || songs.length === 0) {
            this.el.historyList.innerHTML = '<div class="history-item">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>';
            return;
          }

          // –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
          const escapeHtml = (str) => {
            return String(str)
              .replace(/&/g, "&amp;")
              .replace(/</g, "&lt;")
              .replace(/>/g, "&gt;")
              .replace(/"/g, "&quot;")
              .replace(/'/g, "&#039;");
          };

          // –§–æ—Ä–º–∏—Ä—É–µ–º HTML –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
          this.el.historyList.innerHTML = songs.slice(0, 10).map(song => {
            let time = "", title = "";
            
            if (Array.isArray(song)) {
              time = song[0] || "";
              title = song[1] || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";
            } else {
              time = song.time || "";
              title = song.song || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";
            }
            
            return `
              <div class="history-item">
                <span class="history-time">${escapeHtml(time)}</span>
                <span>${escapeHtml(title)}</span>
              </div>
            `;
          }).join("");
        }

        // –ó–∞–ø—É—Å–∫ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        startInfoUpdates() {
          if (this.updateTimer) {
            clearInterval(this.updateTimer);
          }
          
          this.updateTimer = setInterval(() => {
            this.fetchStationInfo();
          }, CONFIG.updateInterval);
        }
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–µ–µ—Ä–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
      const initPlayer = () => {
        window.radioPlayer = new RadioPlayer();
      };

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initPlayer);
      } else {
        initPlayer();
      }
    })();
  </script>
</body>
</html>
